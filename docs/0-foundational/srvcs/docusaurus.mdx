---
sidebar_label: Docusaurus
tags: 
  - completed
---

# Docusaurus
---
Taking advantage of documentation with moder solution

## Deploying Docusaurus

> This exercise aims to deploy docusaurus with GitHub Pages and Typesense as search engine.

- Generic values that you need change
```
website: usen.io
github entity: usen-io
github repo: website
```

### Remote acctions

- pre-requisits:
```shell
TYPESENSE_SCRAPER_API_KEY
example: z3diTzyuQRnBzPbVi2TVp3XKcVfM3Cjv

TYPESENSE_INSTANCE_URL_01
example: europe-01-typesense.usen.io

TYPESENSE_SEARCH_API_KEY
example: r3I89rG7eG36F4eEYSmkyc4NJHaYR5LE

TYPESENSE_COLLECTION_NAME
example: usen-doc
```

- GitHub Repo > Settings > Security > Secrets > Actions
	- Add a github secret for typesense scraper API key:  TYPESENSE_SCRAPER_API_KEY
	- Add a github secret for typesense  instance URL: TYPESENSE_INSTANCE_URL_01
	- Add a github secret for typesense search API key: TYPESENSE_SEARCH_API_KEY
	- Add a github secret for typesense collection name: TYPESENSE_COLLECTION_NAME
- Now continue with Local actions, **after your first git push** back to this point. 
	- GitHub Repo > Settings > Build and deployment > Deploy from a branch > gh-pages
	- Add custom domain: awesome.web

- DNS provider setup
	- CNAME www usen-io.github.io
	- CNAME @ usen-io.github.io

## Local actions

- **GENERIC**: values that you need change
```
website: usen.io
github entity: usen-io
github repo: website
```

- **FETCH:** pre-requisits:
```shell
asdf install nodejs 18.10.0 
asdf global nodejs 18.10.0
npm install -g yarn
```

- **INSTALL:** Docusarus base template:
```shell
npx create-docusaurus@latest website classic
cd website
yarn add docusaurus-theme-search-typesense@next
yarn install
mkdir -p .github/workflows/
```

- **CREATE** :
```yml title=".github/workflows/deploy.yml"
name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to GitHub Pages
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: yarn

      - name: Install dependencies
        run: yarn install --frozen-lockfile
      - name: Build website
        run: yarn build
        env:
          TS_SEARCH_API_KEY: ${{ secrets.TYPESENSE_SEARCH_API_KEY }}
          TS_INSTANCE_URL_01: ${{ secrets.TYPESENSE_INSTANCE_URL_01 }}
          TS_COLLECTION_NAME: ${{ secrets.TYPESENSE_COLLECTION_NAME }}

      # Popular action to deploy to GitHub Pages:
      # Docs: https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-docusaurus
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # Build output to publish to the `gh-pages` branch:
          publish_dir: ./build
          cname: usen.io
          user_name: github-actions[bot]
          user_email: 41898282+github-actions[bot]@users.noreply.github.com

```

- **CREATE:**
```yml title=".github/workflows/typesense.yml"
name: Rebuild Search Index

on:
  workflow_dispatch:
  workflow_run:
    workflows:
    - pages-build-deployment
    types:
    - completed

jobs:
  scrape:
    name: Rebuild Index
    runs-on: ubuntu-latest
    container:
      image: typesense/docsearch-scraper:latest
      options: --user 0 ### incredible usefull variable.
    strategy:
      fail-fast: false
      matrix:
        node:
        - hel
        - fsn
    steps:
    -
      name: Run scraper
      env:
        HOME: /root
        TYPESENSE_API_KEY: ${{ secrets.TYPESENSE_SCRAPER_API_KEY }}
        TYPESENSE_HOST: ${{ secrets.TYPESENSE_INSTANCE_URL_01 }}
        TYPESENSE_PORT: '443'
        TYPESENSE_PROTOCOL: https
        CONFIG: |
          {
            "index_name": "${{ secrets.TYPESENSE_COLLECTION_NAME }}",
            "start_urls": [
              "https://usen.io/"
            ],
            "sitemap_urls": [
              "https://usen.io/sitemap.xml"
            ],
            "sitemap_alternate_links": true,
            "stop_urls": [],
            "selectors": {
              "lvl0": {
                "selector": ".menu__link--sublist.menu__link--active",
                "global": true,
                "default_value": "Documentation"
              },
              "lvl1": "header h1",
              "lvl2": "article h2",
              "lvl3": "article h3",
              "lvl4": "article h4",
              "lvl5": "article h5, article td:first-child",
              "lvl6": "article h6",
              "text": "article p, article li, article td:last-child"
            },
            "strip_chars": " .,;:#",
            "custom_settings": {
              "separatorsToIndex": "_",
              "attributesForFaceting": [
                "language",
                "version",
                "type"
              ],
              "attributesToRetrieve": [
                "hierarchy",
                "content",
                "anchor",
                "url",
                "url_without_anchor",
                "type"
              ]
            },
            "conversation_id": [
              "1090805758"
            ],
            "nb_hits": 8687
          }
      run: pipenv run python -m src.index
      working-directory: /root
```

- **EDIT**:
```js title="docusaurus.config.js"

url: 'https://your-docusaurus-test-site.com',
organizationName: 'facebook',
projectName: 'docusaurus'

```

- **ADD**
```js title="docusaurus.config.js"

deploymentBranch: 'gh-pages',

    themes: ['docusaurus-theme-search-typesense'],
    themeConfig:
      typesense: {
        typesenseCollectionName: process.env.TS_COLLECTION_NAME,        
        typesenseServerConfig: {
          nodes: [
            {
              host: process.env.TS_INSTANCE_URL_01,
              port: 443,
              protocol: 'https',
            },
          ],
          apiKey: process.env.TS_SEARCH_API_KEY,
        },
        typesenseSearchParameters: {},
        contextualSearch: true,
      },
```

- **ADD** git repo
```shell
git-setup
git remote add github git@aa-github:usen-io/website.git
git push github main
```

- **TEST** locally
```shell
yarn start
```


## Formationg the content
#### Sidebar

>The `label`, `className`, and `customProps` attributes are declared in front matter as `sidebar_label`, `sidebar_class_name`, and `sidebar_custom_props`, respectively. Position can be specified in the same way, via `sidebar_position` front matter.

```markdown
sidebar_position: 2  
sidebar_label: Easy  
sidebar_class_name: green
```

### tagging
```
tags: 
  - Demo
  - Getting started
```

